# test-maker-plus-pega-template
Start to test Pega application in a faster and easier way!

## When the template is successfully created: 

- The urls for the environments are set in the `./src/specs/user-data.ts` file (`export function getUrl()`); 
- By default, the `dev` environment is used (You can change it in `./test-maker.pega.ts` file, the `extra` section of the pegaConfig. Then do not forget to adjust the `getUrl` function accordingly). 
  
*** to override the environment name, you need to pass it as a parameter with the script command to run (e.g. `ketm run test-maker.ci.ts --extra env.name=Test`) 
  
This configuration is also using a *user-pool*. It allows us to run test cases in parallel without having conflicts in Pega. 
How it works: 
  
## Operators-manager

   - in the `./test-maker.pega.ts` file, hooks section, the operators source is set depending on current environment (pay attention it must be set only once before tests started, that is why it is in the `beforeAll` hook). 
   - in the `./src/specs/user-data.ts` file an export function `getUsersPool` sets the users according to the environment chosen. 
   - in the same file `./src/specs/user-data.ts` you can keep all your user credentials and to group them by their role. For example, you can create a group of users with the `manager` role or type of access: 
  
```typescript
{
id: `manager`,
alt: [
{ username: `manager1`, password: `<password1>` },
{ username: `manager2`, password: `<password2>`},
{ username: `manager3`, password: `<password3>`},
],
}
```

Typically, we recommend having for _n_ threads _n+1_ users. 

With the above configuration, you can assign the user by it`s role before the login action and unassign after it: 

```typescript
let operator = await runInfo.configuration.extra.operatorsManager.assignOperator('manager');

await runInfo.configuration.extra.operatorsManager.unAssignOperator('manager', operator.username);
```

The operators-manager is taking the first free operator with the given role and logs in to Pega (while the test case is executed, the operator is considered as busy). Do not forget to unassign the operator if he is not needed anymore, otherwise there won`t be free operators for the next test case. 

## Is App Busy Evaluator

*Is App Busy Evaluator* allows tracking and listening to the value of Pega `document-statetracker` element.
If Pega application is busy for some reasons (injects an AJAX call, creates a new screen, calculates some values, creates a report, etc) then the `data-state-busy-status` is changed to 'busy' in DOM.
The evaluator checks this status before each action and allows us to make test cases much more stable, without using hundreds of hardcoded waits. 

The main part of the evaluator is configured in the runner section in the `./test-maker.pega.ts` file: 

```typescript
runner: {
    isAppBusyEvaluator: isAppBusyEvaluator,
}
```

the `bypasslogging` terminal reporter option excludes all the messages about the steps performed by the evaluator but shows the info about the status and retries: 

```typescript
{
                ...reporters.terminal,
                ...{
                    options: <TerminalReporterOptions>{
                        bypass: bypassLogging,
                    },
                },
            },
```

If you want to make your application FAIL when the statetracker is busy for more than 60 seconds, you need to keep this part of the configuration:

```typescript
failure: {
            feature: {
                skipRemainingScenariosOnScenarioFail: async (runInfo: TestRunInfo) => runInfo.appIsBusy,
            },
        },
```

If you DO NOT need it, delete this one and add to the `test-maker.common.ts` file or `./test-maker.pega.ts` file (for example): 

```typescript
failure: {
            feature: {
                skipRemainingScenariosOnScenarioFail: true, //skips all the next scenarios of the feature 
                exitProcessOnFirstFail: false, //terminates the process after the first fail
                skipRemainingStepsOnStepFail: true, //skips all the next steps if one of the steps in the scenario failed
            },
```

(And to make the evaluator SKIP your unit tests, pass the adapter type in this way: )

```typescript
Feature(`SAC-1-1 Create the case via API`)
    .adapters([AdapterType.UNIT])
```

## Other possible configurations to add (Typically, to the `test-maker.common.ts` file): 

### File source 

Shows the path to the test files you need to execute (main Configuration section)

```typescript
source: [`./src/specs/*-spec.ts`],
```

### Suites: 

Defines the collection of tests which are grouped by some attribute and should be executed together (main Configuration section)
```typescript
 suites:
        {
            "Template":{ path: [`./src/**/template-spec.ts`,]
            },
        },
```

*** command to run the suite: `ketm run test-maker.ci.ts --suites TEST`

### Timeouts: 

(the runner Configuration section)

```typescript
timeout: {
            feature: 300000,
            selector: 15000,
            assertion: 17000,
            pageLoad: 10000,
        },
```

### Success Threshold: 

Allows to define the percentage of the successful execution (if the configurations is set like in the example below, test results will have the "Success" status if at least 90% of test cases passed). You can also define your custom Success and Failure messages (the runner section of the Configuration file)

```typescript
 process: {
            successThreshhold: 90,
            failureExitMessage: "The Test Process has failed.",
            successExitMessage: "The Test Process has completed successfully!"
        },
```

### Customize terminal reporter steps:

By default, you will see the information about all the steps in the terminal reporter. If you don`t need such a detailed info, and want to hide any/all details, you can configure the terminal reporter log (main Configuration section): 

For example (if you want to turn all the step logs off in a headless mode (except features) add this snippet to the `test-maker.ci.ts` file): 

```typescript
 reporting: {
        reporters: [
            {
                ...reporters.terminal,
                ...{
                    options: <TerminalReporterOptions>{
                        ignoreLogLevel: false,
                        feature: { start: true, done: true },
                        scenario: { start: false, done: false },
                        step: { start: false, done: false },
                        subStep: { start: false, done: false },
                        hook: { start: false, done: false },
                        controllerAction: { start: false, done: false },
                        selectorAction: { start: false, done: false, retries: false },
                        assertionAction: { start: false, done: false, retries: false },
                        scoreBase: 'feature',
                    },
                },
            },
        ],
    },
```

### Add or specify browsers: 

By default, test cases are executed by Playwright adapter in Chromium browser (installed automatically). If you need to change browsers, add/replace them in the runner section (you can use `chrome`, `firefox`, `safari`, or all of them): 

```typescript
adapters: [
            {
                name: `playwright`,
                options: {
                    default: true,
                    clients: [
                        'chrome',
                        'firefox',
                        'safari',
                    ]
                }
            },
            {
        ],
```

To specify the client (browser) name for particular feature, pass the client name after the Feature in the spec file:  

```typescript
Feature(`Feature name`)
    .clients(['firefox'])
    .Scenario(`Scenario name`)
```

